LAYER
    NAME 'cg67_parcelles'
    TYPE POLYGON
    STATUS ON
    #DEBUG 5
    TEMPLATE fooOnlyForWMSGetFeatureInfo # For GetFeatureInfo
    CONNECTIONTYPE postgis
    PROCESSING "CLOSE_CONNECTION=DEFER" # For performance
    CONNECTION "${mapserver_connection}"
    # Example data for secured layer by restriction area
#DATA "geom FROM (SELECT topology.Geometry(the_topo) as geom, idparcelle, numero FROM cadastre.parcelle as geo, ${mapserver_join_tables} WHERE ST_Contains(${mapserver_join_area}, topology.Geometry(the_topo)) AND ${mapserver_join_where} 'cg67_parcelles') AS foo USING UNIQUE idparcelle USING srid=3857"
DATA "geom FROM (SELECT ST_Transform(topology.Geometry(the_topo), 3857) as geom, idparcelle, numero FROM cadastre.parcelle as geo, ${mapserver_join_tables} WHERE %role_id% IN (${mapfile_data_noarea_subselect} 'cg67_parcelles')) AS foo USING UNIQUE idparcelle USING srid=3857"

    DUMP TRUE # For GetFeatureInfo
    PROJECTION
      "init=epsg:3857"
    END
    OPACITY 50 
    MAXSCALEDENOM 51000
    CLASS
        NAME "Parcelles"
        STYLE
          WIDTH 1
          OUTLINECOLOR 255 255 192
          COLOR 92 155 92
        END
    END

    METADATA
        "wms_title" "Parcelles CG67" # For WMS
        "wms_srs" "epsg:3857" # For WMS

        "gml_include_items" "idparcelle, numero"  # For GetFeatureInfo and WFS GetFeature (QuerryBuilder)
	"gml_types" "auto"
        "gml_featureid" "idparcelle"
        "gml_geom_type" "polygon" # For returning geometries in GetFeatureInfo
        "gml_geometries" "geom" # For returning geometries in GetFeatureInfo
	"wfs_enable_request" "*"

        "wms_metadataurl_href" "http://www.bas-rhin.fr/posplu/index.aspx" # For metadata URL
        "wms_metadataurl_format" "text/html" # For metadata URL
        "wms_metadataurl_type" "TC211" # For metadata URL

        ${mapserver_layer_metadata} # For secured layers
    END
END

LAYER
    NAME 'cg67_batiments'
    TYPE POLYGON
    STATUS ON
    #DEBUG 5
    TEMPLATE fooOnlyForWMSGetFeatureInfo # For GetFeatureInfo
    CONNECTIONTYPE postgis
    PROCESSING "CLOSE_CONNECTION=DEFER" # For performance
    CONNECTION "${mapserver_connection}"
    # Example data for secured layer by restriction area
DATA "geom FROM (SELECT geo.the_geom as geom, ogc_fid AS gid FROM cg67.edigeo_cc49_batiment geo, ${mapserver_join_tables} WHERE ST_Contains(${mapserver_join_area}, geo.the_geom) AND ${mapserver_join_where} 'cg67_batiments') AS foo USING UNIQUE gid USING srid=3857"

    DUMP TRUE # For GetFeatureInfo
    PROJECTION
      "init=epsg:3857"
    END
    OPACITY 80 
    MAXSCALEDENOM 25000
    CLASS
        NAME "Bâtiments"
        STYLE
          WIDTH 1
          OUTLINECOLOR 255 255 192
          COLOR 92 155 92
        END
    END

    METADATA
        "wms_title" "Bâtiments CG67" # For WMS
        "wms_srs" "epsg:3857" # For WMS

        "gml_include_items" "gid"  # For GetFeatureInfo and WFS GetFeature (QuerryBuilder)
	"gml_types" "auto"
        "gml_featureid" "gid"
        "gml_geom_type" "polygon" # For returning geometries in GetFeatureInfo
        "gml_geometries" "geom" # For returning geometries in GetFeatureInfo
	"wfs_enable_request" "*"

        "wms_metadataurl_href" "" # For metadata URL
        "wms_metadataurl_format" "text/html" # For metadata URL
        "wms_metadataurl_type" "TC211" # For metadata URL

        ${mapserver_layer_metadata} # For secured layers
    END
END

LAYER
    NAME 'cg67_numvoie_label'
    GROUP 'cg67_numvoie'
    TYPE POINT
    STATUS ON
    #DEBUG 5
    TEMPLATE fooOnlyForWMSGetFeatureInfo # For GetFeatureInfo
    CONNECTIONTYPE postgis
    PROCESSING "CLOSE_CONNECTION=DEFER" # For performance
    CONNECTION "${mapserver_connection}"
    # Example data for secured layer by restriction area
DATA "geom FROM (SELECT geo.the_geom as geom, ogc_fid AS gid, ogr_atr_val, ogr_angle FROM cg67.edigeo_cc49_numvoie_label geo, ${mapserver_join_tables} WHERE ST_Contains(${mapserver_join_area}, geo.the_geom) AND ${mapserver_join_where} 'cg67_numvoie') AS foo USING UNIQUE gid USING srid=3857"

    DUMP TRUE # For GetFeatureInfo
    PROJECTION
      "init=epsg:3857"
    END
    OPACITY 80
    #MAXSCALEDENOM 30000
    LABELITEM "ogr_atr_val"
    CLASS
#        NAME "Numéro de voie"
        STYLE
#          SIZE 10
#          SYMBOL "circle"
#          OUTLINECOLOR 20 20 20
#          COLOR 195 195 195
        END
        LABEL
           ANGLE [ogr_angle]
           COLOR  50 50 50
           OUTLINECOLOR 255 255 255
           FONT "arial"
           TYPE truetype
           SIZE 8
           POSITION lc
           PARTIALS FALSE
           MAXSCALEDENOM 3000
        END
    END

    METADATA
        "wms_title" "Numéro de voie CG67 (label)" # For WMS
        "wms_group_title" "Numéro de voie CG67"
        "wms_srs" "epsg:3857" # For WMS

        "gml_include_items" "*"  # For GetFeatureInfo and WFS GetFeature (QuerryBuilder)
        #"ows_geom_type" "polygon" # For returning geometries in GetFeatureInfo
        #"ows_geometries" "geom" # For returning geometries in GetFeatureInfo

        "wms_metadataurl_href" "" # For metadata URL
        "wms_metadataurl_format" "text/html" # For metadata URL
        "wms_metadataurl_type" "TC211" # For metadata URL

        ${mapserver_layer_metadata} # For secured layers
    END
END

LAYER
    NAME 'cg67_numvoie_point'
    GROUP 'cg67_numvoie'
    TYPE POINT
    STATUS ON
    #DEBUG 5
    TEMPLATE fooOnlyForWMSGetFeatureInfo # For GetFeatureInfo
    CONNECTIONTYPE postgis
    PROCESSING "CLOSE_CONNECTION=DEFER" # For performance
    CONNECTION "${mapserver_connection}"
    # Example data for secured layer by restriction area
DATA "geom FROM (SELECT geo.the_geom as geom, ogc_fid AS gid FROM cg67.edigeo_cc49_numvoie geo, ${mapserver_join_tables} WHERE ST_Contains(${mapserver_join_area}, geo.the_geom) AND ${mapserver_join_where} 'cg67_numvoie') AS foo USING UNIQUE gid USING srid=3857"

    DUMP TRUE # For GetFeatureInfo
    PROJECTION
      "init=epsg:3857"
    END
    OPACITY 100
    MAXSCALEDENOM 10000
    CLASS
        NAME "Numéro de voie"
        STYLE
          SIZE 5
          SYMBOL "circle"
          OUTLINECOLOR 200 200 200
          COLOR 195 195 195
        END
    END

    METADATA
        "wms_title" "Numéro de voie CG67 (geometrie)" # For WMS
        "wms_group_title" "Numéro de voie CG67"
        "wms_srs" "epsg:3857" # For WMS

        "gml_include_items" "*"  # For GetFeatureInfo and WFS GetFeature (QuerryBuilder)
        #"ows_geom_type" "polygon" # For returning geometries in GetFeatureInfo
        #"ows_geometries" "geom" # For returning geometries in GetFeatureInfo

        "wms_metadataurl_href" "" # For metadata URL
        "wms_metadataurl_format" "text/html" # For metadata URL
        "wms_metadataurl_type" "TC211" # For metadata URL

        ${mapserver_layer_metadata} # For secured layers
    END
END

LAYER
    NAME 'cg67_lieudit_label'
    TYPE POINT
    STATUS ON
    #DEBUG 5
    TEMPLATE fooOnlyForWMSGetFeatureInfo # For GetFeatureInfo
    CONNECTIONTYPE postgis
    PROCESSING "CLOSE_CONNECTION=DEFER" # For performance
    CONNECTION "${mapserver_connection}"
    # Example data for secured layer by restriction area
DATA "geom FROM (SELECT geo.the_geom as geom, ogc_fid AS gid, ogr_atr_val FROM cg67.edigeo_cc49_lieudit_label geo, ${mapserver_join_tables} WHERE ST_Contains(${mapserver_join_area}, geo.the_geom) AND ${mapserver_join_where} 'cg67_lieudit_label') AS foo USING UNIQUE gid USING srid=3857"

    DUMP TRUE # For GetFeatureInfo
    PROJECTION
      "init=epsg:3857"
    END
    OPACITY 80
    LABELITEM "ogr_atr_val"
    CLASS
#        NAME "Lieu dit"
        STYLE
#          SIZE 10
#          SYMBOL "circle"
#          OUTLINECOLOR 20 20 20
#          COLOR 195 195 195
        END
        LABEL
#           ANGLE [ogr_angle]
           COLOR  50 50 50
           OUTLINECOLOR 205 205 205
           SHADOWCOLOR 100 100 100
           SHADOWSIZE 2 2
           FONT "arial"
           TYPE truetype
           SIZE 8
           POSITION cc
           PARTIALS FALSE
           MAXSCALEDENOM 25000
        END
    END

    METADATA
        "wms_title" "Lieu dit CG67 (label)" # For WMS
        "wms_srs" "epsg:3857" # For WMS

        "gml_include_items" "*"  # For GetFeatureInfo and WFS GetFeature (QuerryBuilder)
        #"ows_geom_type" "polygon" # For returning geometries in GetFeatureInfo
        #"ows_geometries" "geom" # For returning geometries in GetFeatureInfo

        "wms_metadataurl_href" "" # For metadata URL
        "wms_metadataurl_format" "text/html" # For metadata URL
        "wms_metadataurl_type" "TC211" # For metadata URL

        ${mapserver_layer_metadata} # For secured layers
    END
END

